{% extends "base.html" %}

{% block title %}Home - The Sayed Blog{% endblock %}

{% block content %}
  {% if featured_posts %}
    {% for post in featured_posts %}
      {% if forloop.first %}
        <!-- Hero Post -->
        {% if post.featured_image %}
          <div class="p-4 p-md-5 mb-4 rounded position-relative overflow-hidden" style="min-height: 320px;">
            <img src="{{ post.featured_image.url }}" class="w-100 position-absolute top-0 start-0" style="object-fit: cover; object-position: center center;">
            <div class="position-absolute top-0 start-0 w-100 h-100 rounded"
                style="background: rgba(0,0,0,0.45); backdrop-filter: blur(3px);"></div>
            <div class="col-lg-7 px-0 position-relative text-white" style="z-index:5;">
              <h1 class="display-5 fw-bold mb-3">{{ post.title }}</h1>
              <p class="lead mb-4">{{ post.short_description|truncatewords:15 }}</p>
              <a href="{% url 'blogpost_detail' slug=post.slug %}" class="btn btn-warning fw-semibold px-4 rounded-3">Continue Reading</a>
            </div>
          </div>
        {% else %}
          <div class="p-4 p-md-5 mb-4 rounded text-bg-dark">
            <div class="col-md-6 px-0">
              <h1 class="display-4 fst-italic">{{ post.title }}</h1>
              <p class="lead my-3">{{ post.short_description|safe }}</p>
              <p class="lead mb-0"><a href="{% url 'blogpost_detail' slug=post.slug %}" class="text-white fw-bold">Continue reading...</a></p>
            </div>
          </div>

        {% endif %}
      {% endif %}
    {% endfor %}
  {% else %}
    <p>No featured posts available.</p>
  {% endif %}
  <!-- Featured Posts -->
  <h2 class="fw-bold mb-4" style="font-size:1.8rem;">Featured Posts</h2>
  <div style="width:60px; height:4px; background:#0d6efd; border-radius:5px; margin-top:-12px; margin-bottom:20px;"></div>
  <div class="row mb-2">
    {% if featured_posts %}
        {% for post in featured_posts %}
            {% if not forloop.first %}
              <div class="col-md-6">
                <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
                  <div class="col p-4 d-flex flex-column position-static">
                    <h3 class="mb-0"><a href="{% url 'blogpost_detail' slug=post.slug %}">{{ post.title }}</a></h3>
                    <div class="mb-1 text-body-secondary">{{ post.created_at|timesince }} ago | {{ post.author }}</div>
                    <p class="card-text mb-auto">{{ post.short_description|truncatewords:50 }}</p>
                  </div>
                </div>
              </div>
            {% endif %}
        {% endfor %}
      {% else %}
        <p>No featured posts available.</p>
    {% endif %}
    
  </div>

  <!-- Recent Articles -->
  <h2 class="fw-bold mb-4" style="font-size:1.8rem;">Recent Articles</h2>
  <div class="row g-5">
    <div class="col-md-8">
      {% if page_obj %}
        {% for post in page_obj %}
          <article class="blog-post mb-4">
            <h3 class="blog-post-title mb-1"><a href="{% url 'blogpost_detail' slug=post.slug %}">{{ post.title }}</a></h3>
            <p class="blog-post-meta">{{ post.created_at|date:"F j, Y" }} by {{ post.author }}</p>
            <p>{{ post.short_description|truncatewords:100 }}</p>
          </article>
        {% endfor %}
        {% comment %} Pagination {% endcomment %}
        <nav aria-label="Page navigation" class="my-5">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page=1">&laquo; First</a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">&laquo; Previous</span></li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active" aria-current="page">
                  <span class="page-link">{{ num }}</span>
                </li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Next &raquo;</span></li>
            {% endif %}
          </ul>
        </nav>

      {% else %}
        <p>No recent posts available.</p>
      {% endif %}
    </div>

    <div class="col-md-4">
      <div class="position-sticky" style="top: 2rem">
        <div class="p-4 mb-3 bg-body-tertiary rounded">
          <h4 class="fst-italic">{{ about_info.about_heading }}</h4>
          <p class="mb-0">{{ about_info.about_content }}</p>
        </div>
        <div class="p-4">
          <h4 class="fst-italic">Follow Me</h4>
          <ol class="list-unstyled">
            {% for item in follow_us %}
              <li><a href="{{ item.platform_url }}" target="_blank" rel="noopener noreferrer">{{ item.platform_name }}</a></li>
            {% endfor %}
          </ol>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
